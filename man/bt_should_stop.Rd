% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bt_stopping.R
\name{bt_should_stop}
\alias{bt_should_stop}
\title{Decide whether to stop adaptive sampling based on stop metrics}
\usage{
bt_should_stop(
  metrics,
  prev_metrics = NULL,
  reliability_target = 0.9,
  sepG_target = 3,
  rel_se_p90_target = 0.3,
  rel_se_p90_min_improve = 0.01,
  max_item_misfit_prop = 0.05,
  max_judge_misfit_prop = 0.05
)
}
\arguments{
\item{metrics}{A one-row tibble returned by \code{\link{bt_stop_metrics}}.}

\item{prev_metrics}{Optional one-row tibble of prior-round metrics (same shape as
\code{metrics}). Used to compute percent improvement criteria.}

\item{reliability_target}{Optional numeric. If not \code{NA}, require
\code{metrics$reliability >= reliability_target}.}

\item{sepG_target}{Optional numeric. If not \code{NA}, require
\code{metrics$sepG >= sepG_target}.}

\item{rel_se_p90_target}{Optional numeric. If not \code{NA}, precision target is met when
\code{metrics$rel_se_p90 <= rel_se_p90_target}.}

\item{rel_se_p90_min_improve}{Optional numeric. If not \code{NA} and \code{prev_metrics}
is provided, compute percent improvement
\code{(prev - current) / prev}. Stalling is defined as
\code{improve_pct <= rel_se_p90_min_improve}.}

\item{max_item_misfit_prop}{Optional numeric. If not \code{NA}, require
\code{metrics$item_misfit_prop <= max_item_misfit_prop} (when metric is available).}

\item{max_judge_misfit_prop}{Optional numeric. If not \code{NA}, require
\code{metrics$judge_misfit_prop <= max_judge_misfit_prop} (when metric is available).}
}
\value{
A list with:
\describe{
\item{stop}{Logical; \code{TRUE} if stopping criteria are met.}
\item{details}{A tibble giving each criterion, its value, threshold, and pass/fail.}
\item{improve}{A tibble with computed percent improvement (if \code{prev_metrics} supplied).}
}
}
\description{
This helper applies combined stopping criteria to the output of
\code{\link{bt_stop_metrics}}. It is intended for round-based adaptive sampling:
compute metrics each round, then call this function to decide whether to continue.
}
\details{
Stopping requires:
\itemize{
\item Reliability and separation thresholds (if provided), AND
\item Fit thresholds (item/judge misfit proportions, if provided), AND
\item Either precision target is met (\code{rel_se_p90 <= rel_se_p90_target}), OR
improvement has stalled relative to the previous round
(\code{rel_se_p90_improve_pct <= rel_se_p90_min_improve}).
}
}
\examples{
m1 <- tibble::tibble(
  reliability = 0.92, sepG = 3.2, rel_se_p90 = 0.25,
  item_misfit_prop = 0.00, judge_misfit_prop = 0.00
)
res <- bt_should_stop(m1, reliability_target = 0.90, sepG_target = 3.0, rel_se_p90_target = 0.30)
res$stop
res$details

}
