% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_set.R
\name{select_core_set}
\alias{select_core_set}
\title{Select a core set of items for BT linking}
\usage{
select_core_set(
  samples,
  core_size = NULL,
  core_pct = 0.1,
  method = c("auto", "pam", "clara", "embeddings", "token_stratified", "random"),
  embeddings = NULL,
  distance = c("cosine", "euclidean"),
  clara_threshold = 2000L,
  clara_samples = 5L,
  clara_sampsize = NULL,
  seed = NULL
)
}
\arguments{
\item{samples}{A tibble/data.frame with columns \code{ID} and \code{text}.}

\item{core_size}{Integer number of core items to select. If \code{NULL},
uses \code{core_pct * nrow(samples)} (clamped to \code{[2, n]}).}

\item{core_pct}{Proportion used when \code{core_size} is \code{NULL}.
Must be in \code{(0, 1]}.}

\item{method}{Selection method: \code{"auto"}, \code{"pam"}, \code{"clara"},
\code{"embeddings"} (alias for \code{"auto"}), \code{"token_stratified"},
or \code{"random"}.}

\item{embeddings}{Optional numeric matrix of embeddings (rows correspond to
samples). Required when \code{method} uses embeddings
(\code{method} in \code{c("auto","pam","clara","embeddings")}).
If \code{rownames(embeddings)} are present, they must contain all sample IDs
and will be used to align rows. Otherwise \code{nrow(embeddings)} must equal
\code{nrow(samples)} and rows are assumed to be in the same order as
\code{samples}.}

\item{distance}{Distance used within embeddings selection. For \code{"cosine"},
embeddings are L2-normalized and Euclidean distance is applied.}

\item{clara_threshold}{Integer. When \code{method = "auto"} (or \code{"embeddings"}),
uses PAM when \code{nrow(samples) <= clara_threshold} and CLARA otherwise.}

\item{clara_samples}{Integer number of CLARA samples (passed to
\code{cluster::clara}).}

\item{clara_sampsize}{Optional integer CLARA subsample size (passed to
\code{cluster::clara}). If \code{NULL}, uses a conservative heuristic.}

\item{seed}{Optional integer seed. When provided, RNG state is restored to its
prior value (or returned to "uninitialized" if it was missing).}
}
\value{
A tibble with columns:
\itemize{
\item \code{ID}: selected core IDs
\item \code{method}: selection method
\item \code{core_rank}: 1..core_size
\item \code{word_count}: word count (only populated for token_stratified)
\item \code{cluster}: cluster label (only for embeddings-based methods)
\item \code{centroid_dist}: squared distance from the selected medoid to the
centroid of its cluster (embeddings-based methods)
}
}
\description{
Selects a representative "core bank" of samples from a larger pool, intended
to be reused across waves/batches for linking Bradley-Terry (BT) scales.
}
\details{
This function does not run any LLM calls. It selects items using one of:
\itemize{
\item \code{"auto"} / \code{"embeddings"}: clustering on a supplied embedding
matrix, then chooses one medoid per cluster. By default, uses PAM for
smaller datasets and CLARA for larger datasets.
\item \code{"token_stratified"}: picks items spaced across the distribution
of word counts (fast fallback when embeddings are not available).
\item \code{"random"}: uniform random sample without replacement.
}
}
\examples{
data("example_writing_samples", package = "pairwiseLLM")

# Token-stratified (no embeddings needed)
core_len <- select_core_set(example_writing_samples, core_size = 4, method = "token_stratified")
core_len

# Embeddings-based (user supplies embeddings matrix)
set.seed(1)
emb <- matrix(rnorm(nrow(example_writing_samples) * 8), ncol = 8)
rownames(emb) <- example_writing_samples$ID
core_emb <- select_core_set(
  example_writing_samples,
  core_size = 5,
  method = "embeddings",
  embeddings = emb,
  seed = 1
)
core_emb

}
