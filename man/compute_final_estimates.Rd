% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_final_estimates.R
\name{compute_final_estimates}
\alias{compute_final_estimates}
\title{Compute final ranking estimates from pairwise results}
\usage{
compute_final_estimates(
  results,
  ids = NULL,
  fit_engine_final = c("bt_firth", "bt_mle", "bt_bayes", "none"),
  bt_bias_reduction = TRUE,
  bt_verbose = FALSE,
  rc_smoothing = 0.5,
  rc_damping = 0,
  ...
)
}
\arguments{
\item{results}{A data frame with columns \code{ID1}, \code{ID2}, and
\code{better_id}. This is typically the \code{$results} output from an
adaptive run.}

\item{ids}{Optional character vector of all item IDs. If \code{NULL}
(default), IDs are inferred from \code{results}.}

\item{fit_engine_final}{Character scalar giving the preferred final BT engine.
Options are \code{"bt_firth"} (bias-reduced BT if available), \code{"bt_mle"}
(standard MLE BT), \code{"bt_bayes"} (Bayesian BT approximation via \pkg{rstanarm}
when installed), or \code{"none"} (skip BT and return Rank Centrality only).
Default \code{"bt_firth"}.}

\item{bt_bias_reduction}{Logical; attempt a bias-reduced Bradley--Terry fit
via \pkg{BradleyTerry2} when available (default \code{TRUE}). When
\code{fit_engine_final = "bt_firth"}, this should typically be left as
\code{TRUE}.}

\item{bt_verbose}{Logical; if \code{TRUE}, allow model-fitting warnings to be
printed. If \code{FALSE} (default), suppress common fitting warnings.}

\item{rc_smoothing}{Numeric scalar \code{>= 0}. Passed to
\code{\link{fit_rank_centrality}}.}

\item{rc_damping}{Numeric scalar in \code{[0,1)}. Passed to
\code{\link{fit_rank_centrality}}.}

\item{...}{Additional arguments forwarded to \code{\link{fit_rank_centrality}}.}
}
\value{
A list with elements:
\describe{
\item{estimates}{A tibble with one row per \code{ID}, including:
\itemize{
\item \code{theta_bt_firth}: Bradley--Terry ability estimate (centered)
\item \code{se_bt_firth}: standard error for \code{theta_bt_firth}
\item \code{rank_bt_firth}: rank of \code{theta_bt_firth} (1 = highest)
\item \code{pi_rc}: Rank Centrality stationary probability
\item \code{theta_rc}: centered \code{log(pi_rc)}
\item \code{rank_rc}: rank of \code{theta_rc} (1 = highest)
\item \code{wins}, \code{losses}, \code{ties}: counts from \code{results}
\item \code{n_appear}, \code{n_pos1}, \code{n_pos2}: appearance counts
\item \code{component_id}: connected-component label from Rank Centrality
\item \code{bt_engine_requested}: requested final BT engine
\item \code{bt_engine_used}: BT engine actually used (or \code{"rank_centrality"})
\item \code{bt_status}: \code{"succeeded"}, \code{"fallback"}, or \code{"skipped"}
\item \code{bt_failure_reason}: non-empty string when fallback occurred
}
}
\item{bt_fit}{The full Bradley--Terry fit object (list) as returned internally.}
\item{rc_fit}{The Rank Centrality fit list returned by \code{\link{fit_rank_centrality}}.}
\item{diagnostics}{A list of run-level diagnostics including whether bias
reduction was used and basic graph stats.}
\item{provenance}{A list describing which engines were requested and used,
and why any fallback occurred.}
}
}
\description{
This helper computes a comprehensive set of final ranking outputs from a
set of pairwise comparison results. It is intended for "end of run" use,
where the full set of comparisons is available.
}
\details{
The function fits (when available):
\itemize{
\item A Bradley--Terry model via \pkg{BradleyTerry2}. If bias reduction is
enabled (default), the function attempts a bias-reduced fit (often called
"Firth" correction). If the bias-reduced fit is unavailable, the function
falls back to a standard maximum likelihood Bradley--Terry fit.
If \pkg{BradleyTerry2} is not installed (it is a suggested dependency), the
function continues and returns Rank Centrality estimates with BT columns
filled as \code{NA}.
\item A Rank Centrality model (spectral / random-walk based) via
\code{\link{fit_rank_centrality}}.
\item Optionally, a Bayesian Bradley--Terry approximation when
\code{fit_engine_final = "bt_bayes"}. This is implemented via
\pkg{rstanarm} when installed (also suggested). If unavailable, the function
falls back to Rank Centrality.
}

In addition to model-based estimates, the returned table includes
graph-derived summaries such as win/loss/tie counts, appearance counts
(degree proxies), and connectivity diagnostics from Rank Centrality.
}
\examples{
data("example_writing_pairs")
out <- compute_final_estimates(example_writing_pairs)
out$estimates

}
