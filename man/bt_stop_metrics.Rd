% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bt_stopping.R
\name{bt_stop_metrics}
\alias{bt_stop_metrics}
\title{Compute stopping metrics from a Bradleyâ€“Terry model fit}
\usage{
bt_stop_metrics(
  fit,
  metrics = NULL,
  ids = NULL,
  prev_fit = NULL,
  core_ids = NULL,
  se_probs = c(0.5, 0.9, 0.95),
  fit_bounds = c(0.7, 1.3),
  stability_topk = 50L,
  stability_topk_ties = c("id", "random"),
  stability_seed = NULL
)
}
\arguments{
\item{fit}{A list returned by \code{\link{fit_bt_model}} containing a \code{$theta}
tibble/data frame with columns \code{ID}, \code{theta}, \code{se}.}

\item{metrics}{Deprecated. Retained for backward compatibility with older calls that passed \code{metrics} as the second positional argument. Use \verb{ids=} and \verb{fit_bounds=} instead.}

\item{ids}{Optional character vector of item IDs to compute precision summaries on.
If \code{NULL}, uses all items in \code{fit$theta}.}

\item{prev_fit}{Optional prior fit (same structure as \code{fit}) used for drift metrics.
Must be provided together with \code{core_ids}.}

\item{core_ids}{Optional character vector of core IDs used for drift metrics.
Must be provided together with \code{prev_fit}.}

\item{se_probs}{Numeric vector of probabilities for SE quantiles. Default:
\code{c(0.5, 0.9, 0.95)}.}

\item{fit_bounds}{Numeric length-2 vector giving lower/upper bounds for acceptable
infit/outfit when diagnostics are available. Default: \code{c(0.7, 1.3)}.}

\item{stability_topk}{Integer. K used for top-K overlap stability when \code{prev_fit} is
provided. Default: 50.}

\item{stability_topk_ties}{Character. Tie-breaking rule for Top-K stability.
Default: "id" (deterministic). Use "random" for randomized tie-breaking.}

\item{stability_seed}{Optional integer seed used only when \code{stability_topk_ties = "random"}.}
}
\value{
A one-row tibble of stopping metrics.
}
\description{
This helper computes round-level summary metrics used for adaptive sampling and
stopping decisions. It is designed to work with the object returned by
\code{\link{fit_bt_model}} (which includes \code{fit$theta} with columns
\code{ID}, \code{theta}, and \code{se}).
}
\details{
The output is a one-row tibble with:
\itemize{
\item Precision summaries (e.g., SE mean, max, and quantiles),
\item Scale summaries (SD of \code{theta}),
\item Scale-free precision metrics (SE divided by SD of \code{theta}),
\item Optional fit/diagnostic summaries (separation index and misfit proportions),
\item Optional drift metrics for a core set relative to a prior fit.
}

You can compute precision summaries on a subset of IDs (e.g., only newly-added
items) via \code{ids}. Drift metrics are added when both \code{prev_fit} and
\code{core_ids} are provided.
}
\examples{
# A minimal, CRAN-safe "mock fit" with the required structure:
fit <- list(
  engine = "mock",
  theta = tibble::tibble(
    ID = c("A", "B", "C", "D"),
    theta = c(0, 1, 2, 3),
    se = c(0.20, 0.30, 0.40, 0.50)
  )
)

# Compute metrics on all items
bt_stop_metrics(fit)

# Compute metrics only on a subset (e.g., newly-added items)
bt_stop_metrics(fit, ids = c("A", "C"))

# Add core drift metrics relative to a previous fit
prev_fit <- list(
  engine = "mock",
  theta = tibble::tibble(
    ID = c("A", "B", "C", "D"),
    theta = c(0, 0.5, 2.5, 3),
    se = c(0.20, 0.20, 0.20, 0.20)
  )
)
bt_stop_metrics(
  fit,
  prev_fit = prev_fit,
  core_ids = c("A", "B", "C", "D")
)

}
