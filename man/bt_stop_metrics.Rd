% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bt_stopping.R
\name{bt_stop_metrics}
\alias{bt_stop_metrics}
\title{Compute stopping diagnostics for adaptive BT runs}
\usage{
bt_stop_metrics(
  fit,
  metrics = NULL,
  ids = NULL,
  prev_fit = NULL,
  core_ids = NULL,
  se_probs = c(0.5, 0.9, 0.95),
  fit_bounds = c(0.7, 1.3)
)
}
\arguments{
\item{fit}{A fitted BT object returned by \code{fit_bt_model()} (or a compatible
object) containing \code{theta} estimates and standard errors.}

\item{metrics}{A one-row tibble/data.frame of metrics for the current round.
Typically the latest row of the runner's \code{out$metrics}. If \code{NULL},
the function will compute what it can from \code{fit} alone.

\strong{Backward compatibility:} if the second positional argument is a
character vector and \code{ids} is not supplied, it is treated as \code{ids}
(legacy calling convention).}

\item{ids}{Optional character vector of IDs to compute per-ID summaries for
(e.g., core IDs). If supplied, IDs not present in \code{fit$theta$ID} are
tolerated as long as at least one requested ID is present; if none are
present, an error is thrown.}

\item{prev_fit}{Optional previous fitted BT object used for drift diagnostics.
Must be supplied together with \code{core_ids} (or neither).}

\item{core_ids}{Optional character vector of IDs defining the linking/core set
for drift diagnostics. Must be supplied together with \code{prev_fit} (or
neither).}

\item{se_probs}{Numeric vector of probabilities in (0, 1) used for SE
quantiles (e.g., \code{c(0.5, 0.9, 0.95)}).}

\item{abs_shift_probs}{Numeric vector of probabilities in (0, 1) used for
absolute-shift quantiles in drift metrics.}

\item{drift_methods}{Character vector of correlation methods for drift metrics.
Values are passed through to drift computation (e.g., \code{"pearson"},
\code{"spearman"}).}

\item{...}{Additional arguments reserved for future expansion.}
}
\value{
A list containing updated stopping diagnostics, including summaries
appended to \code{metrics} when provided.
}
\description{
Computes and/or updates a set of stopping diagnostics (reliability, separation,
SE summaries, optional drift metrics) from a fitted BT model and a per-round
metrics row/tibble.
}
\examples{
# A minimal, CRAN-safe "mock fit" with the required structure:
fit <- list(
  engine = "mock",
  theta = tibble::tibble(
    ID = c("A", "B", "C", "D"),
    theta = c(0, 1, 2, 3),
    se = c(0.20, 0.30, 0.40, 0.50)
  )
)

# Compute metrics on all items
bt_stop_metrics(fit)

# Compute metrics only on a subset (e.g., newly-added items)
bt_stop_metrics(fit, ids = c("A", "C"))

# Add core drift metrics relative to a previous fit
prev_fit <- list(
  engine = "mock",
  theta = tibble::tibble(
    ID = c("A", "B", "C", "D"),
    theta = c(0, 0.5, 2.5, 3),
    se = c(0.20, 0.20, 0.20, 0.20)
  )
)
bt_stop_metrics(
  fit,
  prev_fit = prev_fit,
  core_ids = c("A", "B", "C", "D")
)

}
