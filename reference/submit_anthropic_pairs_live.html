<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Live Anthropic (Claude) comparisons for a tibble of pairs — submit_anthropic_pairs_live • pairwiseLLM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Live Anthropic (Claude) comparisons for a tibble of pairs — submit_anthropic_pairs_live"><meta name="description" content="This is a robust row-wise wrapper around
anthropic_compare_pair_live. It takes a tibble of pairs
(ID1 / text1 / ID2 / text2), submits each pair to the Anthropic
Messages API, and collects the results."><meta property="og:description" content="This is a robust row-wise wrapper around
anthropic_compare_pair_live. It takes a tibble of pairs
(ID1 / text1 / ID2 / text2), submits each pair to the Anthropic
Messages API, and collects the results."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pairwiseLLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage-guides"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with pairwiseLLM</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-batch-workflows.html">Advanced: Submitting and Polling Multiple Batches</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adaptive-pairing" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adaptive Pairing</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adaptive-pairing"><li><a class="dropdown-item" href="../articles/adaptive-pairing.html">Adaptive Pairing &amp; Ranking</a></li>
    <li><a class="dropdown-item" href="../articles/bayesian-btl-adaptive-pairing-design.html">Design: Bayesian BTL Adaptive Pairing</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/prompt-template-bias.html">Template Positional Bias</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shmercer/pairwiseLLM" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Live Anthropic (Claude) comparisons for a tibble of pairs</h1>
      <small class="dont-index">Source: <a href="https://github.com/shmercer/pairwiseLLM/blob/master/R/anthropic_live.R" class="external-link"><code>R/anthropic_live.R</code></a></small>
      <div class="d-none name"><code>submit_anthropic_pairs_live.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is a robust row-wise wrapper around
<code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code>. It takes a tibble of pairs
(ID1 / text1 / ID2 / text2), submits each pair to the Anthropic
Messages API, and collects the results.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">submit_anthropic_pairs_live</span><span class="op">(</span></span>
<span>  <span class="va">pairs</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">trait_name</span>,</span>
<span>  <span class="va">trait_description</span>,</span>
<span>  prompt_template <span class="op">=</span> <span class="fu"><a href="set_prompt_template.html">set_prompt_template</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  anthropic_version <span class="op">=</span> <span class="st">"2023-06-01"</span>,</span>
<span>  reasoning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"enabled"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  status_every <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_raw <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_thoughts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pairs">pairs<a class="anchor" aria-label="anchor" href="#arg-pairs"></a></dt>
<dd><p>Tibble or data frame with at least columns <code>ID1</code>,
<code>text1</code>, <code>ID2</code>, <code>text2</code>. Typically created by
<code><a href="make_pairs.html">make_pairs</a></code>, <code><a href="sample_pairs.html">sample_pairs</a></code>, and
<code><a href="randomize_pair_order.html">randomize_pair_order</a></code>.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Anthropic model name (for example <code>"claude-sonnet-4-5"</code>,
<code>"claude-haiku-4-5"</code>, or <code>"claude-opus-4-5"</code>).</p></dd>


<dt id="arg-trait-name">trait_name<a class="anchor" aria-label="anchor" href="#arg-trait-name"></a></dt>
<dd><p>Trait name to pass to <code>anthropic_compare_pair_live</code>.</p></dd>


<dt id="arg-trait-description">trait_description<a class="anchor" aria-label="anchor" href="#arg-trait-description"></a></dt>
<dd><p>Trait description to pass to
<code>anthropic_compare_pair_live</code>.</p></dd>


<dt id="arg-prompt-template">prompt_template<a class="anchor" aria-label="anchor" href="#arg-prompt-template"></a></dt>
<dd><p>Prompt template string, typically from
<code><a href="set_prompt_template.html">set_prompt_template</a></code>.</p></dd>


<dt id="arg-api-key">api_key<a class="anchor" aria-label="anchor" href="#arg-api-key"></a></dt>
<dd><p>Optional Anthropic API key. Defaults to
<code>Sys.getenv("ANTHROPIC_API_KEY")</code>.</p></dd>


<dt id="arg-anthropic-version">anthropic_version<a class="anchor" aria-label="anchor" href="#arg-anthropic-version"></a></dt>
<dd><p>Anthropic API version string passed as the
<code>anthropic-version</code> HTTP header. Defaults to <code>"2023-06-01"</code>.</p></dd>


<dt id="arg-reasoning">reasoning<a class="anchor" aria-label="anchor" href="#arg-reasoning"></a></dt>
<dd><p>Character scalar passed to
<code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code> (one of <code>"none"</code> or
<code>"enabled"</code>).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, prints status, timing, and result
summaries.</p></dd>


<dt id="arg-status-every">status_every<a class="anchor" aria-label="anchor" href="#arg-status-every"></a></dt>
<dd><p>Integer; print status / timing for every
<code>status_every</code>-th pair. Defaults to 1 (every pair).</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, shows a textual progress bar.</p></dd>


<dt id="arg-include-raw">include_raw<a class="anchor" aria-label="anchor" href="#arg-include-raw"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, each row of the returned tibble
will include a <code>raw_response</code> list-column with the parsed JSON body
from Anthropic. Note: Raw responses are not saved to the incremental CSV file.</p></dd>


<dt id="arg-include-thoughts">include_thoughts<a class="anchor" aria-label="anchor" href="#arg-include-thoughts"></a></dt>
<dd><p>Logical or <code>NULL</code>; forwarded to
<code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code>. When <code>TRUE</code> and
<code>reasoning = "none"</code>, the underlying calls upgrade to extended
thinking mode (<code>reasoning = "enabled"</code>), which implies
<code>temperature = 1</code> and adds a <code>thinking</code> block. When
<code>FALSE</code> or <code>NULL</code>, <code>reasoning</code> is used as-is.</p></dd>


<dt id="arg-save-path">save_path<a class="anchor" aria-label="anchor" href="#arg-save-path"></a></dt>
<dd><p>Character string; optional file path (e.g., "output.csv")
to save results incrementally. If the file exists, the function reads it
to identify and skip pairs that have already been processed (resume mode).
Requires the <code>readr</code> package.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, enables parallel processing using
<code>future.apply</code>. Requires the <code>future</code> and <code>future.apply</code>
packages.</p></dd>


<dt id="arg-workers">workers<a class="anchor" aria-label="anchor" href="#arg-workers"></a></dt>
<dd><p>Integer; the number of parallel workers (threads) to use if
<code>parallel = TRUE</code>. Defaults to 1.
<strong>Guidance:</strong> Anthropic rate limits vary significantly by tier. Start
conservatively (e.g., 2-4 workers) to avoid HTTP 429 errors.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional Anthropic parameters (for example <code>temperature</code>,
<code>top_p</code>, <code>max_tokens</code>) passed on to
<code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code>. When <code>pair_uid</code> is
supplied via <code>...</code>, it is used verbatim as <code>custom_id</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing three elements:</p><dl><dt>results</dt>
<dd><p>A tibble with one row per successfully processed pair.</p></dd>

<dt>failed_pairs</dt>
<dd><p>A tibble containing the rows from <code>pairs</code> that
failed to process (due to API errors or timeouts), along with an
<code>error_message</code> column.</p></dd>

<dt>failed_attempts</dt>
<dd><p>A tibble of attempt-level failures (retries,
timeouts, parse errors, invalid winners), separate from observed outcomes.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function offers:</p><ul><li><p><strong>Parallel Processing:</strong> Uses the <code>future</code> package to process
multiple pairs simultaneously.</p></li>
<li><p><strong>Incremental Saving:</strong> Writes results to a CSV file as they complete.
If the process is interrupted, re-running the function with the same
<code>save_path</code> will automatically skip pairs that were already successfully processed.</p></li>
<li><p><strong>Error Separation:</strong> Returns valid results and failed pairs separately,
making it easier to debug or retry specific failures.</p></li>
</ul><p><strong>Temperature and reasoning behaviour</strong></p>
<p>Temperature and extended-thinking behaviour are controlled by
<code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code>:</p><ul><li><p>When <code>reasoning = "none"</code> (no extended thinking), the default
<code>temperature</code> is <code>0</code> (deterministic) unless you explicitly
supply a different <code>temperature</code> via <code>...</code>.</p></li>
<li><p>When <code>reasoning = "enabled"</code> (extended thinking), Anthropic
requires <code>temperature = 1</code>. If you supply a different value, an
error is raised by <code><a href="anthropic_compare_pair_live.html">anthropic_compare_pair_live</a></code>.</p></li>
</ul><p>If you set <code>include_thoughts = TRUE</code> while <code>reasoning = "none"</code>,
the underlying calls upgrade to <code>reasoning = "enabled"</code>, which in turn
implies <code>temperature = 1</code> and adds a <code>thinking</code> block to the API
request. When <code>include_thoughts = FALSE</code> (the default), and you leave
<code>reasoning = "none"</code>, the effective default temperature is <code>0</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Requires ANTHROPIC_API_KEY and network access.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"example_writing_samples"</span>, package <span class="op">=</span> <span class="st">"pairwiseLLM"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pairs</span> <span class="op">&lt;-</span> <span class="va">example_writing_samples</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="make_pairs.html">make_pairs</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="sample_pairs.html">sample_pairs</a></span><span class="op">(</span>n_pairs <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="randomize_pair_order.html">randomize_pair_order</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="trait_description.html">trait_description</a></span><span class="op">(</span><span class="st">"overall_quality"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmpl</span> <span class="op">&lt;-</span> <span class="fu"><a href="set_prompt_template.html">set_prompt_template</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1. Sequential execution with incremental saving</span></span></span>
<span class="r-in"><span><span class="va">res_claude</span> <span class="op">&lt;-</span> <span class="fu">submit_anthropic_pairs_live</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pairs             <span class="op">=</span> <span class="va">pairs</span>,</span></span>
<span class="r-in"><span>  model             <span class="op">=</span> <span class="st">"claude-sonnet-4-5"</span>,</span></span>
<span class="r-in"><span>  trait_name        <span class="op">=</span> <span class="va">td</span><span class="op">$</span><span class="va">name</span>,</span></span>
<span class="r-in"><span>  trait_description <span class="op">=</span> <span class="va">td</span><span class="op">$</span><span class="va">description</span>,</span></span>
<span class="r-in"><span>  prompt_template   <span class="op">=</span> <span class="va">tmpl</span>,</span></span>
<span class="r-in"><span>  reasoning         <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>  save_path         <span class="op">=</span> <span class="st">"results_seq.csv"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2. Parallel execution (faster)</span></span></span>
<span class="r-in"><span><span class="va">res_par</span> <span class="op">&lt;-</span> <span class="fu">submit_anthropic_pairs_live</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pairs             <span class="op">=</span> <span class="va">pairs</span>,</span></span>
<span class="r-in"><span>  model             <span class="op">=</span> <span class="st">"claude-sonnet-4-5"</span>,</span></span>
<span class="r-in"><span>  trait_name        <span class="op">=</span> <span class="va">td</span><span class="op">$</span><span class="va">name</span>,</span></span>
<span class="r-in"><span>  trait_description <span class="op">=</span> <span class="va">td</span><span class="op">$</span><span class="va">description</span>,</span></span>
<span class="r-in"><span>  prompt_template   <span class="op">=</span> <span class="va">tmpl</span>,</span></span>
<span class="r-in"><span>  save_path         <span class="op">=</span> <span class="st">"results_par.csv"</span>,</span></span>
<span class="r-in"><span>  parallel          <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  workers           <span class="op">=</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_par</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check for failures</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">res_par</span><span class="op">$</span><span class="va">failed_pairs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Some pairs failed:"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res_par</span><span class="op">$</span><span class="va">failed_pairs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sterett H. Mercer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

