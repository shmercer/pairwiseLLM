<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Resume polling and download results for multiple batch jobs — llm_resume_multi_batches • pairwiseLLM</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Resume polling and download results for multiple batch jobs — llm_resume_multi_batches"><meta name="description" content="This function takes the output of llm_submit_pairs_multi_batch() (or a
previously written registry CSV) and polls each batch until completion,
downloading and parsing results as they finish.  It implements a
conservative polling loop with a configurable interval between rounds and
a small delay between individual jobs to reduce the risk of API rate‑limit
errors.  The httr2 retry wrapper is still invoked for each API call, so
transient HTTP errors will be retried with exponential back‑off."><meta property="og:description" content="This function takes the output of llm_submit_pairs_multi_batch() (or a
previously written registry CSV) and polls each batch until completion,
downloading and parsing results as they finish.  It implements a
conservative polling loop with a configurable interval between rounds and
a small delay between individual jobs to reduce the risk of API rate‑limit
errors.  The httr2 retry wrapper is still invoked for each API call, so
transient HTTP errors will be retried with exponential back‑off."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pairwiseLLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage-guides"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with pairwiseLLM</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-batch-workflows.html">Advanced: Submitting and Polling Multiple Batches</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adaptive-pairing" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adaptive Pairing</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adaptive-pairing"><li><a class="dropdown-item" href="../articles/adaptive-pairing.html">⭐ Adaptive Pairing &amp; Ranking (Tutorial)</a></li>
    <li><a class="dropdown-item" href="../articles/bayesian-btl-adaptive-pairing-design.html">Design: Bayesian BTL + Adaptive Pairing (v3.1)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/prompt-template-bias.html">Template Positional Bias</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shmercer/pairwiseLLM" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Resume polling and download results for multiple batch jobs</h1>
      <small class="dont-index">Source: <a href="https://github.com/shmercer/pairwiseLLM/blob/master/R/llm_multi_batch.R" class="external-link"><code>R/llm_multi_batch.R</code></a></small>
      <div class="d-none name"><code>llm_resume_multi_batches.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes the output of <code><a href="llm_submit_pairs_multi_batch.html">llm_submit_pairs_multi_batch()</a></code> (or a
previously written registry CSV) and polls each batch until completion,
downloading and parsing results as they finish.  It implements a
conservative polling loop with a configurable interval between rounds and
a small delay between individual jobs to reduce the risk of API rate‑limit
errors.  The httr2 retry wrapper is still invoked for each API call, so
transient HTTP errors will be retried with exponential back‑off.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">llm_resume_multi_batches</span><span class="op">(</span></span>
<span>  jobs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interval_seconds <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  per_job_delay <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  write_results_csv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_jsonl <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  write_registry <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tag_prefix <span class="op">=</span> <span class="st">"&lt;BETTER_SAMPLE&gt;"</span>,</span>
<span>  tag_suffix <span class="op">=</span> <span class="st">"&lt;/BETTER_SAMPLE&gt;"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  write_combined_csv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  combined_csv_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  openai_max_retries <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-jobs">jobs<a class="anchor" aria-label="anchor" href="#arg-jobs"></a></dt>
<dd><p>A list of job objects returned by
<code><a href="llm_submit_pairs_multi_batch.html">llm_submit_pairs_multi_batch()</a></code>.  If <code>NULL</code>, a registry CSV is loaded
from <code>output_dir</code> and converted into an internal jobs structure.</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Directory containing the batch files and (optionally) the
registry CSV.  If <code>jobs</code> is <code>NULL</code>, this directory must be supplied so
that the registry can be loaded.  When <code>jobs</code> is provided and
<code>output_dir</code> is <code>NULL</code>, the directory is inferred from the first job’s
<code>batch_output_path</code>.  When writing results CSVs or updating the registry,
this directory is used.</p></dd>


<dt id="arg-interval-seconds">interval_seconds<a class="anchor" aria-label="anchor" href="#arg-interval-seconds"></a></dt>
<dd><p>Number of seconds to wait between rounds of polling
unfinished batches.  The default (<code>60</code>) mirrors the example in the
advanced vignette.</p></dd>


<dt id="arg-per-job-delay">per_job_delay<a class="anchor" aria-label="anchor" href="#arg-per-job-delay"></a></dt>
<dd><p>Number of seconds to wait between polling individual
jobs within a single round.  A small delay (e.g. 2) can help prevent 429
(Too Many Requests) responses.</p></dd>


<dt id="arg-write-results-csv">write_results_csv<a class="anchor" aria-label="anchor" href="#arg-write-results-csv"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, each batch’s parsed results are
written to a CSV file (<code>csv_path</code>) in <code>output_dir</code> as soon as they are
available.  If <code>FALSE</code> (the default), results are kept in memory.</p></dd>


<dt id="arg-keep-jsonl">keep_jsonl<a class="anchor" aria-label="anchor" href="#arg-keep-jsonl"></a></dt>
<dd><p>Logical; if <code>FALSE</code>, the <code>.jsonl</code> input and output files
will be deleted after the job results have been parsed.  Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-write-registry">write_registry<a class="anchor" aria-label="anchor" href="#arg-write-registry"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, a CSV registry of batch jobs
will be written (or updated) at the end of polling.  When reading
jobs from a saved registry via <code>output_dir</code>, this argument can be used
to control whether the registry is refreshed on disk as job statuses
change.  Defaults to <code>FALSE</code>.  See <code><a href="llm_submit_pairs_multi_batch.html">llm_submit_pairs_multi_batch()</a></code> for
additional details on the registry format.</p></dd>


<dt id="arg-tag-prefix-tag-suffix">tag_prefix, tag_suffix<a class="anchor" aria-label="anchor" href="#arg-tag-prefix-tag-suffix"></a></dt>
<dd><p>Character strings passed to
<code><a href="parse_anthropic_batch_output.html">parse_anthropic_batch_output()</a></code> and <code><a href="parse_gemini_batch_output.html">parse_gemini_batch_output()</a></code>.  These
tags mark the start and end of the “better” sample in each provider’s
output.  The defaults match those used in the vignette.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, prints progress messages during
polling and result processing.  Messages include the batch ID, provider,
and current state on each polling round, as well as summary messages
when combined results are written to disk.  Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-write-combined-csv">write_combined_csv<a class="anchor" aria-label="anchor" href="#arg-write-combined-csv"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, the combined results tibble
returned by the function will also be written to a CSV file.  The path
to write this file is determined by <code>combined_csv_path</code>.  Defaults to
<code>FALSE</code>.</p></dd>


<dt id="arg-combined-csv-path">combined_csv_path<a class="anchor" aria-label="anchor" href="#arg-combined-csv-path"></a></dt>
<dd><p>Optional file path for the combined results CSV.
If <code>write_combined_csv = TRUE</code> and <code>combined_csv_path</code> is <code>NULL</code>, the
combined results will be written to
<code>file.path(output_dir, "combined_results.csv")</code>.  When a non‑NULL
value is supplied, it is treated as an absolute path if it begins with
“/”, “~/”, or a Windows drive letter (e.g. “C:”), or if it contains a
directory component (i.e. <code>dirname(combined_csv_path) != "."</code>).  In that
case it will be used exactly as given.  Otherwise the file name is
assumed to be relative to <code>output_dir</code>.  This argument is ignored when
<code>write_combined_csv = FALSE</code>.</p></dd>


<dt id="arg-openai-max-retries">openai_max_retries<a class="anchor" aria-label="anchor" href="#arg-openai-max-retries"></a></dt>
<dd><p>Integer giving the maximum number of times to
retry certain OpenAI API calls when a transient HTTP 5xx error occurs.
In particular, when downloading batch output with
<code><a href="openai_download_batch_output.html">openai_download_batch_output()</a></code>, the function will attempt to fetch
the output file up to <code>openai_max_retries</code> times if an
<code>httr2_http_500</code> error is raised.  Between retries the function sleeps
for <code>per_job_delay</code> seconds.  Set to a small positive value (e.g. 3)
to automatically recover from occasional server errors.  Defaults to 3.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with four elements: <code>jobs</code>, the updated jobs list with each
element containing parsed results and a <code>done</code> flag; <code>combined</code>, a tibble
obtained by binding all completed results (<code>NULL</code> if no batches
completed); <code>failed_attempts</code>, a tibble of failed attempts captured
during normalization; and <code>batch_failures</code>, a tibble describing batches
that reached a terminal non-success status. If <code>write_results_csv</code> is
<code>TRUE</code>, the combined tibble is still returned in memory. If
<code>write_combined_csv</code> is <code>TRUE</code>, the combined tibble is also written to a
CSV file on disk (see <code>combined_csv_path</code> for details) but is still
returned in memory.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Continuing the example from llm_submit_pairs_multi_batch():</span></span></span>
<span class="r-in"><span><span class="co"># After submitting multiple batches, resume polling and combine the results.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Suppose `outdir` is the directory where batch files were written and</span></span></span>
<span class="r-in"><span><span class="co"># `jobs` is the list of job metadata returned by llm_submit_pairs_multi_batch().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">llm_resume_multi_batches</span><span class="op">(</span></span></span>
<span class="r-in"><span>  jobs               <span class="op">=</span> <span class="va">jobs</span>,</span></span>
<span class="r-in"><span>  output_dir         <span class="op">=</span> <span class="va">outdir</span>,</span></span>
<span class="r-in"><span>  interval_seconds   <span class="op">=</span> <span class="fl">60</span>,</span></span>
<span class="r-in"><span>  per_job_delay      <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  write_results_csv  <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  keep_jsonl         <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  write_registry     <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  verbose            <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  write_combined_csv <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The combined results are available in the `combined` element</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">combined</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sterett H. Mercer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

